# "Wire" 通信协议设计

[TOC]

## 协议简介

* W（Wire）协议是可伸缩型TCP长连接协议，目的是减少连接中的数据传输消耗，同时满足多场景需求进行动态扩展

## 协议内容

### 协议总览

![image-20210125234537410.png](https://i.loli.net/2021/01/27/sgOLWaIScGjTNx5.png)

> _**颜色区分：** **白色**底色为固定头，**黄色**为可变头，具体可见协议控制_
>
> **数据包长度：** 从长度标识列开始，后续数据的有效长度
>
> **协议控制：** 见控制列详解
>
> **命令：** 最大支持255个命令配置
>
> **状态：** 最大支持255个状态
>
> **协议序列号：** 标记消息包的ID，确定消息的【请求/响应对】

### 协议控制

![image-20210125234708358.png](https://i.loli.net/2021/01/27/PopJ7sft39geGBn.png)

> reserved: 保留位
>
> **压缩：**0 默认不压缩，1 gzip压缩
>
> **命令：**协议通过命令模式进行有效执行，可变头中【命令】属性控制；（0 不存在命令，1 存在命令）
>
> **负载：**除去协议头外，带有有效负载的数据，需要自行解析，可变； （0 不存在负载，1 存在负载） 
>
> **序列：**0 不存在序列协议头 1 存在序列协议头
>
> **状态：**0 不存在状态字段，1 存在状态字段
>
> **方向：**控制数据包的流向
>
> | 标记 | 方向                                       |
> | ---- | ------------------------------------------ |
> | 0    | 客户端往服务器                             |
> | 1    | 服务器响应客户端                           |
> | 2    | 服务器主动推送客户端                       |
> | 3    | 客户端响应服务器（适用某些需要响应的场景） |

